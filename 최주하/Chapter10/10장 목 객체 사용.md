# 10ì¥. ëª© ê°ì²´ ì‚¬ìš©


>ğŸ’¡**10ì¥ í•™ìŠµ ë‚´ìš©**
>
>- Httpìƒì˜ ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ì‘ìš© í•˜ëŠ” ë©”ì„œë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
>- ê·¸ ê³¼ì •ì—ì„œ ëŠë¦° ì†ë„ì™€ í†µì œí•  ìˆ˜ ì—†ëŠ” http apiê°€ìš©ì„±ì— ëŒ€í•œ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ìŠ¤í…ì„ ì‚¬ìš©í•œë‹¤.
>- ì´ í›„, ìŠ¤í…ì„ ëª©ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹œë‹¤.

ìœ„ëŠ” ì±…ì— ì‘ì„±ëœ 10ì¥ì˜ ë‚´ìš©ì´ë‹¤. ì´ë²ˆ ì¥ì—ì„œëŠ” **í…ŒìŠ¤íŠ¸ ë”ë¸”ì˜ ê°œë…**ê³¼ **í…ŒìŠ¤íŠ¸ ë”ë¸”ì˜ ì¢…ë¥˜**ë¥¼ ì¤‘ì ìœ¼ë¡œ ì •ë¦¬í•˜ê³ ì í•œë‹¤.

# í…ŒìŠ¤íŠ¸ ë”ë¸”

---

- **`Test Double`**:  í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤ì œ ê°ì²´ ëŒ€ì‹  ì‚¬ìš©ë˜ëŠ” ê°€ì§œ ê°ì²´.
    - ì±…ì—ì„œ ìŠ¤í…, ëª©ê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ ë”ë¸”ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ” **ì™¸ë¶€ì™€ì˜ ìƒí˜¸ ì‘ìš©ì´ í…ŒìŠ¤íŠ¸ ì†ë„ë¥¼ ì €í•˜** ì‹œí‚¤ê³ , ì½”ë“œì—ì„œ ì‚¬ìš©í–ˆë˜ Nominatimì´ ì œê³µí•˜ëŠ” **APIê°€ í•­ìƒ ê°€ìš©í•œ ì§€ì— ëŒ€í•œ ë³´ì¥í•  ìˆ˜ ì—†**ì—ˆê¸° ë•Œë¬¸ì´ë‹¤.
    - í…ŒìŠ¤íŠ¸ ë”ë¸”ì˜ ì‚¬ìš© ëª©ì ì€ ì™¸ë¶€ ì˜ì¡´ì„± ì œê±° ë¿ë§Œ ì•„ë‹ˆë¼ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì€ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸ í•  ìˆ˜ ìˆë‹¤ëŠ” ì ë„ ìˆë‹¤.
    - í…ŒìŠ¤íŠ¸ ë”ë¸”ì˜ ì¢…ë¥˜ì—ëŠ” **Dummy, Fake, Stub, Spy, Mock**ì´ ìˆë‹¤. ì±…ì—ì„œëŠ” ì´ ì¤‘ Stub, Mockì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

## í…ŒìŠ¤íŠ¸ ë”ë¸”: Dummy

---

- **Dummy**
    - ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•Šê³ , í˜•ì‹ ìƒ ì „ë‹¬ë˜ëŠ” ê°ì²´
    - **ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜** ë•Œë¬¸ì— ë„£ëŠ” ê°ì²´.
        - ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë€, ë©”ì„œë“œë¥¼ êµ¬ë³„í•˜ëŠ” ì •ë³´ì´ë‹¤. ë©”ì„œë“œ ì´ë¦„ê³¼ ë§¤ê°œë³€ìˆ˜ íƒ€ì…/ê°œìˆ˜/ìˆœì„œê°€ ì´ì— ì†í•œë‹¤.

## í…ŒìŠ¤íŠ¸ ë”ë¸”: Fake

---

- **Fake**
    - ì‹¤ì œì²˜ëŸ¼ ë™ì‘í•˜ê²Œ ë§Œë“  ëª¨í˜• ê°ì²´
    - DBë‚˜ ì™¸ë¶€ APIë¥¼ ëŒ€ì²´í•˜ëŠ” ë° ì£¼ë¡œ ì‚¬ìš©
      - ì˜ˆì‹œ ì½”ë“œ
          - test/java/member/repository/FakeMemberRepository.java

              ```java
              @NoArgsConstructor
              class FakeMemberRepository implements MemberRepository{
                      private Map<String, Member> store = new HashMap<>();
                    
                      public Member save(Member member){
                              store.put(member.getName(), member);
                              return member;
                      }
                    
                      public Member findByName(String name){
                              return store.get(name);
                      }
              }
              ```

            ì‹¤ì œ DB ëŒ€ì‹  HashMapì„ í†µí•´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ì‘ì„±í–ˆë‹¤.<br><br>

          - test/java/config/FakeRepoConfig.java

              ```java
              @TestConfiguration
              static class FakeRepoConfig{
                      @Bean
                      public MemberRepository memberRepository(){
                              return new FakeMemberRepository();
                      }
              }
              ```

            Fake repositoryë¥¼ TestConfigë¡œ ë“±ë¡í•œë‹¤.<br><br>

          - test/java/member/service/MemberServiceTest.java

              ```java
              @Import(FakeRepoConfig.class)
              class MemberServiceTest{
            
                  @Autowired
                  MemberService memberService;
            
                  @Autowired
                  MemberRepository memberRepository;
                    
                      @DisplayName("ì´ë¦„ì„ í†µí•´ ì‚¬ìš©ì ì¡°íšŒ_ì„±ê³µ")
                      @Test
                      void success_findByName(){
                              Member member = Member.builder()
                                                              .name("test")
                                                              .email("test123@test.com")
                                                              .build();
                            
                              memberRepository.save(member);
                            
                              Member foundMember = memberService.findByName("test");
                            
                              assertEquals("test", foundMember.getName());		
                      }
              }
              ```

            **`@Import`** ë¥¼ ì‚¬ìš©í•´ FakeRepoConfig ìë°” íŒŒì¼ì„ ì„í¬íŠ¸í•œë‹¤.
    
            í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤ì œ dbë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.


## í…ŒìŠ¤íŠ¸ ë”ë¸”: Stub

---

- **Stub**
    - ë¯¸ë¦¬ ì •í•´ì§„ ê°’ì„ ì‘ë‹µí•˜ëŠ” ê°ì²´
      - ì˜ˆì‹œì½”ë“œ
          - ì±…ì—ì„œëŠ” ì™¸ë¶€ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. í…ŒìŠ¤íŠ¸ì—ì„œ ì‹¤ì œë¡œ APIë¥¼ ì‚¬ìš©í•œë‹¤ë©´, í…ŒìŠ¤íŠ¸ê°€ ëŠë ¤ì§„ë‹¤. ë˜í•œ, í•­ìƒ ì•ˆì •í•˜ë‹¤ëŠ” ë³´ì¥ì„ í•  ìˆ˜ ì—†ë‹¤.
          - ë”°ë¼ì„œ, APIê°€ ë°˜í™˜í•˜ëŠ” ê°’ì„ í•˜ë“œì½”ë”©í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
          - src/iloveyouboss/AddressRetriever.java

              ```java
              public Address retrieve(double latitude, double longitude) throws IOException, ParseException{
            
                      String parms = String.format("lat=%.6lon=%.6f", latitude, longitude);
                      String response = http.get(
                              "http://open.mapquestapi.com/nominatim/v1/reverse?format=json&"+parms);
                    
                      JSONObject obj = (JSONObject)new JSONParser().parse(response);
              }
              ```

          - test/iloveyouboss/AddressRetrieverTest.java

              ```java
              @Test
              public void answerAppropriateAddressForValidCoordinates() throws IOException, ParseException{
                      // ìŠ¤í… - nominatim apiì—ì„œ ë°›ì€ ê²°ê³¼ ê°’ì„ í•˜ë“œ ì½”ë”©í•´ë‘”ë‹¤.
                      Http http = (String url) -> 
                      "{\"address\":{"
                      +"\"house_number\":\"324\","
                      +"\"road\":\"North Tejon Street\"}"
                      +"}";
                    
                      AddressRetriever retriever = new AddressRetriever(http);
                    
                      Address address = retriever.retrieve(38.0, -104.0);
                    
                      assertThat(address.houseNumber, equalTo("324"));
                      assertThat(address.houseNumber, equalTo("North Tejon Street"));
              }
              ```


## í…ŒìŠ¤íŠ¸ ë”ë¸”: Spy

---

- Spy
    - ì‹¤ì œ ê°ì²´ì²˜ëŸ¼ ë™ì‘í•˜ë©´ì„œ í˜¸ì¶œ ì—¬ë¶€ë‚˜ í˜¸ì¶œëœ ê°’ ë“±ì„ ì¶”ì 
      - ì˜ˆì‹œ ì½”ë“œ
          - MemberServiceì—ì„œ NotificationServiceì˜ sendNotificationì„ ì‚¬ìš©í•´ì„œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚¸ë‹¤.
          - test/java/member/service/NotificationSpyService.java

              ```java
              class NotificationSpyService implements NotificationService{
            		
                      private boolean called = false;
            		
                      @Override
                      public void sendNotification(String message){
                              this.called = true;
                              // ì‹¤ì œ ì „ì†¡ ë¡œì§ì€ ìƒëµí•  ìˆ˜ ìˆë‹¤.
                      }
            		
                      // í˜¸ì¶œì—¬ë¶€ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•œ ë©”ì„œë“œ ìƒì„±
                      public boolean wasCalled(){
                              return called;
                      }
              }
              ```
              â­â­ ì‹¤ì œ ê°ì²´ì˜ ë¡œì§ì€ ìƒëµí•˜ê±°ë‚˜ ê°„ë‹¨íˆ ì²˜ë¦¬í•œë‹¤. 
              **í…ŒìŠ¤íŠ¸ì—ì„œ í˜¸ì¶œ ì—¬ë¶€, í˜¸ì¶œëœ ê°’ ë“±ì„ ì¶”ì í•˜ê¸° ìœ„í•œ ë©”ì„œë“œë¥¼ ì‘ì„±**í•œë‹¤!<br><br>

          - test/java/member/service/notificationServiceTest.java
            
              ```java
              @Test
              void notifyUser_sendsNotification(){
              NotificationSpyService spy = new NotificationSpyService();
              UserService service = new UserService(spy);
            		
              service.notifyUser("Hello!");
              assertTrue(spy.wasCalled());
              }
              ```
              í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œëŠ” spyì—ì„œ ì¶”ì ì„ ìœ„í•´ ì‘ì„±í•œ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ê²€ì¦í•˜ë©´ ëœë‹¤!


## í…ŒìŠ¤íŠ¸ ë”ë¸”: Mock

---

- **Mock**
    - í–‰ë™ì„ ê²€ì¦í•˜ëŠ”ë° ì‚¬ìš©
      - ì˜ˆì‹œ ì½”ë“œëŠ” Spyì—ì„œ ì‚¬ìš©í•œ ì½”ë“œë¥¼ í™œìš©í•œë‹¤.
          - Spyì—ì„œëŠ” MemberServiceì˜ notifyUser()ë©”ì„œë“œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í–ˆë‹¤.
          - ì—¬ê¸°ì„œëŠ” NotificationServiceë¥¼ mockìœ¼ë¡œ ë°”ê¾¸ì–´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

              ```java
              @Test
              void notifyUser_sendsNotification(){
                      NotificationService mock = mock(NotificationService.class);
                      UserService service = new UserService(mock);
            		
                      service.notify("Hello!");
            		
                      verify(mock).send("Hello!");	
              }
              ```

            Spyì—ì„œëŠ” ì¶”ì ì„ ìœ„í•œ ë¡œì§ì„ ì§ì ‘ êµ¬í˜„í•´ì•¼ í–ˆì§€ë§Œ, mockì„ ì‚¬ìš©í•˜ë©´ Mockitoê°€ ëŒ€ì‹  ê°€ì§œ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨íˆ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.


## ë§ˆë¬´ë¦¬!

---

- ê°œë… ì •ë¦¬
    - **`Test Double`**: í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê°€ì§œ ê°ì²´
        - **`dummy`**: ì‹¤ì œë¡œ ì‚¬ìš©ë˜ì§€ ì•Šê³ , ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ì¶©ì¡±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
        - **`fake`**: ì§„ì§œì²˜ëŸ¼ ë™ì‘í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆê²Œ í•˜ëŠ” ê°€ì§œ ê°ì²´. ë¡œì§ì„ êµ¬í˜„í•´ì•¼ í•¨!
        - **`stub`**: ê³ ì •ëœ ì‘ë‹µ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê°ì²´
        - **`spy`**: í˜¸ì¶œ ì—¬ë¶€, í˜¸ì¶œëœ ê°’ì„ ì¶”ì í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•´ì£¼ì–´ì•¼ í•¨!
        - **`mock`**: mockitoë¥¼ ì‚¬ìš©í•´ì„œ ê°„ë‹¨í•˜ê²Œ ê²€ì¦í•  ìˆ˜ ìˆìŒ!